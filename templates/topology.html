{% extends "base.html" %}

{% block title %}Network Topology - {{ super() }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h3 mb-0">
                <i class="fas fa-project-diagram text-primary me-2"></i>Network Topology
            </h1>
            <div class="badge bg-info fs-6" id="connection-status">
                <i class="fas fa-spinner fa-spin me-1"></i>Loading...
            </div>
        </div>
    </div>
</div>

<!-- Network Statistics -->
<div class="row mb-4">
    <div class="col-12">
        <div class="topology-stats">
            <div class="row">
                <div class="col-md-3">
                    <div class="stat-item">
                        <span class="stat-number" id="total-devices">-</span>
                        <small>Total Devices</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-item">
                        <span class="stat-number" id="online-devices">-</span>
                        <small>Online Devices</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-item">
                        <span class="stat-number" id="total-connections">-</span>
                        <small>Network Links</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-item">
                        <span class="stat-number" id="network-health">-</span>
                        <small>Network Health</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Topology Controls -->
<div class="row mb-4">
    <div class="col-12">
        <div class="topology-controls">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <button class="btn btn-primary control-btn" onclick="refreshTopology()">
                        <i class="fas fa-sync-alt me-1"></i>Refresh
                    </button>
                    <button class="btn btn-success control-btn" onclick="autoLayout()">
                        <i class="fas fa-magic me-1"></i>Auto Layout
                    </button>
                    <button class="btn btn-info control-btn" onclick="fitNetwork()">
                        <i class="fas fa-expand-arrows-alt me-1"></i>Fit to Screen
                    </button>
                    <button class="btn btn-warning control-btn" onclick="togglePhysics()">
                        <i class="fas fa-play me-1"></i>Physics
                    </button>
                    <button class="btn btn-secondary control-btn" onclick="exportTopology()">
                        <i class="fas fa-download me-1"></i>Export
                    </button>
                </div>
                <div class="col-md-4">
                    <div class="form-check form-switch d-inline-block me-3">
                        <input class="form-check-input" type="checkbox" id="showLabels" checked onchange="toggleLabels()">
                        <label class="form-check-label" for="showLabels">Show Labels</label>
                    </div>
                    <div class="form-check form-switch d-inline-block">
                        <input class="form-check-input" type="checkbox" id="realTimeUpdates" onchange="toggleRealTime()">
                        <label class="form-check-label" for="realTimeUpdates">Real-time</label>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main Topology Visualization -->
<div class="row mb-4">
    <div class="col-12">
        <div class="topology-container position-relative">
            <div id="topology-network"></div>
            <div id="loading-overlay" class="loading-overlay" style="display: none;">
                <div class="text-center">
                    <div class="spinner"></div>
                    <p class="mt-3">Loading network topology...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Legend -->
<div class="row">
    <div class="col-12">
        <div class="legend">
            <h6><i class="fas fa-info-circle me-2"></i>Legend</h6>
            <div class="legend-item">
                <span class="legend-color" style="background-color: #007bff;"></span>
                <span>Switch</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background-color: #28a745;"></span>
                <span>Router</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background-color: #6f42c1;"></span>
                <span>Access Point</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background-color: #fd7e14;"></span>
                <span>Firewall</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background-color: #dc3545;"></span>
                <span>Offline Device</span>
            </div>
            <div class="legend-item">
                <span style="border: 2px solid #28a745; width: 20px; height: 2px; display: inline-block; margin-right: 8px; vertical-align: middle;"></span>
                <span>Active Link</span>
            </div>
        </div>
    </div>
</div>

<!-- Device Details Modal -->
<div class="modal fade" id="deviceModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deviceModalTitle">Device Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="deviceModalBody">
                <!-- Device details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="testDeviceConnection()">Test Connection</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Add the CSS link -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/topology.css') }}">
<!-- vis.js for network visualization -->
<script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
<!-- Topology-specific JavaScript -->
<script src="{{ url_for('static', filename='js/topology.js') }}"></script>
{% endblock %}